# Wafer Headers

Pre-extracted C++/CUDA/CUTLASS headers for the Wafer VS Code extension's IntelliSense support.

## Contents

This repository hosts header archives that the Wafer extension downloads to provide IntelliSense (autocomplete, error checking, go-to-definition) for GPU kernel development.

## Available Packages

| ID                    | Name                        | Size   | Contents                                                                               |
| --------------------- | --------------------------- | ------ | -------------------------------------------------------------------------------------- |
| `cuda-13-cutlass-4.3` | CUDA 13.0.2 + CUTLASS 4.3.2 | ~30 MB | CUDA 13.0.2 headers, CUTLASS 4.3.2 headers (from GitHub), C++ standard library headers |

## How It Works

1. User enables "IntelliSense Headers" in Wafer extension settings (requires Beta Mode)
2. Extension downloads `manifest.json` to discover available packages
3. Extension downloads and extracts the selected header archive (~30 MB compressed, ~100 MB extracted)
4. Extension configures `.vscode/c_cpp_properties.json` with include paths
5. Full IntelliSense works locally without network requests

## Manifest Format

```json
{
	"version": 1,
	"images": {
		"cuda-13-cutlass-4.3": {
			"name": "CUDA 13.0.2 + CUTLASS 4.3.2",
			"docker_image": "wafer/nvidia-mega-dev:latest",
			"archive_url": "https://github.com/wafer-ai/wafer-headers/releases/download/headers-v2/cuda-13-cutlass-4.3.tar.gz",
			"size_bytes": 31457280,
			"sha256": "...",
			"include_paths": ["cuda/include", "cutlass/include", "cpp/include"]
		}
	}
}
```

## Adding New Header Packages

To add a new header package (e.g., CUDA 14.0 + CUTLASS 5.0):

### Step 1: Extract Headers from Docker Image

```bash
# From the main wafer repository
cd /path/to/wafer

# Build or use an existing Docker image with the headers you need
# Example: Build mega-dev image
cd services/wafer-api
docker build -f Dockerfile.mega-dev -t wafer/nvidia-mega-dev:latest .

# Extract headers using the extract-headers.py script
cd /path/to/wafer
python scripts/extract-headers.py \
  --image wafer/nvidia-mega-dev:latest \
  --id cuda-14-cutlass-5.0 \
  --type mega \
  --name "CUDA 14.0 + CUTLASS 5.0" \
  --cdn-base-url "https://github.com/wafer-ai/wafer-headers/releases/download/headers-v3" \
  --output ./output
```

This creates:
- `output/cuda-14-cutlass-5.0.tar.gz` - Compressed header archive
- `output/cuda-14-cutlass-5.0-manifest.json` - Manifest entry with metadata

### Step 2: Create GitHub Release

```bash
# Copy the tar.gz to the wafer-headers repository
cp output/cuda-14-cutlass-5.0.tar.gz /path/to/wafer-headers/

# Create a new GitHub release with the archive
cd /path/to/wafer-headers
gh release create headers-v3 \
  --title "Headers v3 - CUDA 14.0 + CUTLASS 5.0" \
  --notes "CUDA 14.0 + CUTLASS 5.0 headers for IntelliSense support" \
  cuda-14-cutlass-5.0.tar.gz
```

**Note:** Use a new release tag (e.g., `headers-v3`, `headers-v4`) for each new package version.

### Step 3: Update manifest.json

```bash
cd /path/to/wafer-headers

# Read the manifest entry generated by extract-headers.py
cat /path/to/wafer/output/cuda-14-cutlass-5.0-manifest.json

# Update manifest.json to include the new entry
# The archive_url should point to the GitHub release:
# https://github.com/wafer-ai/wafer-headers/releases/download/headers-v3/cuda-14-cutlass-5.0.tar.gz
```

Example updated `manifest.json`:

```json
{
  "version": 1,
  "images": {
    "cuda-13-cutlass-4.3": {
      "name": "CUDA 13.0.2 + CUTLASS 4.3.2",
      "docker_image": "wafer/nvidia-mega-dev:latest",
      "archive_url": "https://github.com/wafer-ai/wafer-headers/releases/download/headers-v2/cuda-13-cutlass-4.3.tar.gz",
      "size_bytes": 4131151,
      "sha256": "43d556dc665706928e9b65e53d16242ef27c96e0be3fb5060b1d1240dc0c4e2a",
      "updated_at": "2025-12-07T19:37:54.774901+00:00",
      "include_paths": ["cpp/include", "cutlass/include", "cuda/include"]
    },
    "cuda-14-cutlass-5.0": {
      "name": "CUDA 14.0 + CUTLASS 5.0",
      "docker_image": "wafer/nvidia-mega-dev:latest",
      "archive_url": "https://github.com/wafer-ai/wafer-headers/releases/download/headers-v3/cuda-14-cutlass-5.0.tar.gz",
      "size_bytes": 4500000,
      "sha256": "abc123...",
      "updated_at": "2025-12-08T10:00:00.000000+00:00",
      "include_paths": ["cpp/include", "cutlass/include", "cuda/include"]
    }
  }
}
```

### Step 4: Commit and Push

```bash
cd /path/to/wafer-headers

# Add the updated manifest.json
git add manifest.json
git commit -m "feat: add CUDA 14.0 + CUTLASS 5.0 headers package"
git push origin main
```

### Step 5: Verify

1. Check that the manifest is accessible:
   ```bash
   curl https://raw.githubusercontent.com/wafer-ai/wafer-headers/main/manifest.json
   ```

2. Verify the release asset is downloadable:
   ```bash
   curl -I https://github.com/wafer-ai/wafer-headers/releases/download/headers-v3/cuda-14-cutlass-5.0.tar.gz
   ```

3. Test in the extension:
   - The new package should appear in the "Header Package" dropdown
   - Users can download and use it for IntelliSense

## Regenerating Existing Headers

To regenerate headers for an existing package (e.g., updating CUDA 13.0.2 to 13.0.3):

Follow the same steps as "Adding New Header Packages", but:
- Use the same package ID (e.g., `cuda-13-cutlass-4.3`) or create a new one (e.g., `cuda-13-cutlass-4.3-updated`)
- Create a new release tag (e.g., `headers-v2.1` or `headers-v3`)
- Update the `archive_url` in the manifest entry to point to the new release

## License

Headers are extracted from:

-   NVIDIA CUDA Toolkit 13.0.2 (NVIDIA License)
-   CUTLASS 4.3.2 from GitHub (BSD-3-Clause License)
-   C++ Standard Library (varies by distribution)
